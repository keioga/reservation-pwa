<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="manifest" href="manifest.json">
  <title>予約アプリ - トップ</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script src="sw.js"></script>
  
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    body { font-family: Arial, Helvetica Neue, Helvetica, sans-serif; }
    #calendar { max-width: 900px; margin: 0 auto; }
  </style>

</head>
<body>
  <h1>StudyPC.net</h1>
  <h2 id="schoolname">板宿校</h2>

  <!-- <p id="username">ログイン情報を取得しています…</p> -->

  レッスンの予約・キャンセルが可能です。

  <div class="resdiv">
  <button class="res">予　約</button>
  <button class="res">キャンセル</button>
  </div>
  <!-- <a href="reserve.html">予約ページへ進む</a> -->

  モーダル部分
<div class="modal fade" id="reservationModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">予約入力</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="reservationForm">
          <input type="hidden" id="reservationDate">
          <div class="mb-3">
            <label for="reservationTime" class="form-label">時間</label>
            <!-- <input type="time" class="form-control" id="reservationTime"> -->
            <div class="form-check">
              <input class="form-check-input" type="checkbox" name="reservationTime" value="09:00" id="time9">
              <label class="form-check-label" for="time9">9:00</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" name="reservationTime" value="10:00" id="time10">
              <label class="form-check-label" for="time10">10:00</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" name="reservationTime" value="11:00" id="time11">
              <label class="form-check-label" for="time11">11:00</label>
            </div>

          </div>
          <div class="mb-3">
            <label for="reservationName" class="form-label">名前</label>
            <input type="text" class="form-control" id="reservationName">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" id="saveReservation">保存</button>
      </div>
    </div>
  </div>
</div>

<!-- FullCalendar部分 -->

  <div id="calendar"></div>

  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>
  
<script>
  document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');
    var calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      expandRows: false,
      height:'auto',
      contentHeight:'auto',
      locale:'ja',
      titleFormat: { year: 'numeric', month: 'long' }, 
      dayCellContent: function(arg) {
        // arg.date は Date オブジェクト
        return arg.date.getDate(); // 数字だけを返す
      },
      events: [
        { title: '予約済', start: '2025-12-02', color: 'red' },
        { title: '予約済', start: '2025-12-05', color: 'blue' }
      ],
      dateClick: function(info) {
        // クリックした日付をモーダルに渡す
        document.getElementById('reservationDate').value = info.dateStr;
        var modal = new bootstrap.Modal(document.getElementById('reservationModal'));
        modal.show();
      }


      // events: async function(fetchInfo, successCallback, failureCallback) {
      //   const res = await fetch('/api/reservations'); // GASで作ったAPI
      //   const data = await res.json();
      //   successCallback(data.map(r => ({
      //     title: r.name + '予約',
      //     start: r.date,
      //     color: 'red'
      //   })));
      // }


    });
    calendar.render();

    // 保存ボタン処理
  document.getElementById('saveReservation').addEventListener('click', function() {
    var date = document.getElementById('reservationDate').value;
    // var time = document.getElementById('reservationTime').value;
    var name = document.getElementById('reservationName').value;


    // // カレンダーに即反映
    // calendar.addEvent({
    //   // title: name + '予約',
    //   title:'予約',
    //   start: date + 'T' + time,
    //   color: 'red'
    // });

      // 選択された時間をすべて取得
    var times = [];
    document.querySelectorAll('input[name="reservationTime"]:checked').forEach(function(checkbox) {
      times.push(checkbox.value);
    });

    // 選択された時間ごとにイベントを追加
    times.forEach(function(time) {
      calendar.addEvent({
        title: name + '予約',
        start: date + 'T' + time,  // 例: "2025-12-06T09:00"
        color: 'red'
      });
    });


    // TODO: fetchでGAS APIに送信してスプレッドシート保存
    // fetch('/api/saveReservation', { method:'POST', body: JSON.stringify({date,time,name}) })

    bootstrap.Modal.getInstance(document.getElementById('reservationModal')).hide();
  });

  });
</script>

<div>
<h3>今月の予約状況</h3>

</div>

  <footer>
    <small>レッスン予約アプリ0.11</small>
  </footer>
  </body>
</html>